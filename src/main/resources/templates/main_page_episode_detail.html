<head>
    <link rel="stylesheet" href="/main_page_episode_detail.css" />
</head>

<div class="webtoon-container">
    <!-- 웹툰 썸네일 이미지와 제목, 작가 정보 -->
    <div class="webtoon-header">
        <img th:src="@{${webtoon.thumbnailImg}}" alt="웹툰 썸네일" class="webtoon-thumbnail" />
        <div class="webtoon-details">
            <h1 th:text="${webtoon.title}"></h1> <!-- 웹툰 제목 -->
            <p th:text="${webtoon.content}"></p> <!-- 웹툰 내용 -->
            <div class="webtoon-info">
                <p th:text="'# ' + ${webtoon.genreType.genreTypename}"></p> <!-- 장르 이름 -->
                <p th:text="'작가: ' + ${webtoon.siteUser.nickname}"></p> <!-- 작가 이름 -->
            </div>
        </div>
    </div>
    <div class="recommendation">
        <!-- 추천 버튼 -->
        <form th:action="@{|/webtoon/recommend/${webtoon.id}|}" method="POST">
            <button type="submit" class="btn-recommend" th:text="${message != null ? message : '추천'}"></button>
        </form>
        <!-- 추천 수 -->
        <span>추천 수: <span th:text="${webtoon.likes}"></span></span>

        <!-- 관심작품 등록/취소 -->
        <form id="favoriteForm" th:action="@{|/webtoon/favorite/${webtoon.id}|}" method="POST">
            <button type="submit" id="favoriteButton" class="btn-favorite">
                <span id="heartIcon" class="heart-icon" th:classappend="${isFavorite} ? 'filled' : ''">♡</span>
                <span th:text="${isFavorite} ? '관심작품 취소' : '관심작품 등록'"></span>
            </button>
        </form>
    </div>


    <!-- 에피소드 리스트 -->
    <ul class="episode-list">
        <a th:each="episode : ${episodesByWebtoon[webtoon.id]}" th:href="@{/webtoon/episode/{id}(id=${episode.id})}" class="episode-link">
            <li>
                <img th:src="@{${episode.thumbnailImg}}" alt="에피소드 썸네일" class="episode-thumbnail" />
                <div class="episode-details">
                    <span class="episode-title" th:text="${episode.title}"></span>
                    <span class="episode-date" th:text="${#temporals.format(episode.createdDate, 'yyyy-MM-dd')}"></span>
                </div>
            </li>
        </a>
    </ul>
</div>
<script>
    document.getElementById('favoriteForm').addEventListener('submit', function (event) {
        event.preventDefault(); // 폼 제출 방지

        const form = this;
        const heartIcon = document.getElementById('heartIcon');
        const buttonText = form.querySelector('span:nth-child(2)');
        const isFavorite = heartIcon.classList.contains('filled');

        // 서버로 관심작품 상태 전송
        fetch(form.action, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ favorite: !isFavorite }),
        })
        .then(response => {
            if (response.ok) {
                // 상태 토글
                if (isFavorite) {
                    heartIcon.classList.remove('filled'); // 하트 색 제거
                    buttonText.textContent = '관심작품 등록';
                } else {
                    heartIcon.classList.add('filled'); // 하트 색 추가
                    buttonText.textContent = '관심작품 취소';
                }
            } else {
                alert('작업에 실패했습니다. 다시 시도해주세요.');
            }
        })
        .catch(error => console.error('Error:', error));
    });
</script>

