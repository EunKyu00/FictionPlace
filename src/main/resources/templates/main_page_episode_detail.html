<head>
    <link rel="stylesheet" href="/main_page_episode_detail.css" />
    <!-- Font Awesome 최신 CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        .favorite-not-registered i {
            color: gray; /* 기본 상태는 회색 */
        }

        .favorite-registered i {
            color: gold; /* 등록된 상태는 노란색 */
        }

        .favorite-not-registered span,
        .favorite-registered span {
            font-size: 14px;
        }
    </style>
</head>

<div class="webtoon-container">
    <div class="webtoon-header">
        <img th:src="@{${webtoon.thumbnailImg}}" alt="웹툰 썸네일" class="webtoon-thumbnail" />
        <div class="webtoon-details">
            <h1 th:text="${webtoon.title}"></h1>
            <p th:text="${webtoon.content}"></p>
            <div class="webtoon-info">
                <p th:text="'# ' + ${webtoon.genreType.genreTypename}"></p>
                <p th:text="'작가: ' + ${webtoon.siteUser.nickname}"></p>
            </div>
        </div>
    </div>

    <div class="recommendation">
        <form th:action="@{|/webtoon/recommend/${webtoon.id}|}" method="POST">
            <button type="submit" class="btn-recommend" th:text="${message != null ? message : '추천'}"></button>
        </form>
        <span>추천 수: <span th:text="${webtoon.likes}"></span></span>

        <!-- 로그인된 사용자에 따라 즐겨찾기 버튼 처리 -->
        <form th:action="@{/webtoon/favorite/{id}(id=${webtoon.id})}" method="POST">
            <button type="submit" class="btn-favorite" id="favorite-btn">
                <span th:class="${favorite ? 'favorite-registered' : 'favorite-not-registered'}">
                    <i class="fas fa-star"></i>
                    <span th:text="${favorite ? '관심작품 해제' : '관심작품 등록'}"></span>
                </span>
            </button>
        </form>
    </div>

    <!-- 에피소드 리스트 -->
    <ul class="episode-list">
        <a th:each="episode : ${episodesPage.content}" th:href="@{/webtoon/episode/{id}(id=${episode.id})}" class="episode-link">
            <li>
                <img th:src="@{${episode.thumbnailImg}}" alt="에피소드 썸네일" class="episode-thumbnail" />
                <div class="episode-details">
                    <span class="episode-title" th:text="${episode.title}"></span>
                    <span class="episode-date" th:text="${#temporals.format(episode.createdDate, 'yyyy-MM-dd')}"></span>
                </div>
            </li>
        </a>
    </ul>

    <!-- 페이징 -->
    <div class="pagination">
        <span th:if="${episodesPage.number > 0}">
            <a th:href="@{|/main/page/webtoon/episode/${webtoon.id}?page=${episodesPage.number - 1}&size=${size != null ? size : 10}|}">이전</a>
        </span>
        <span><span th:text="${episodesPage.number + 1}"></span> / <span th:text="${episodesPage.totalPages}"></span></span>
        <span th:if="${episodesPage.number + 1 < episodesPage.totalPages}">
            <a th:href="@{|/main/page/webtoon/episode/${webtoon.id}?page=${episodesPage.number + 1}&size=${size != null ? size : 10}|}">다음</a>
        </span>
    </div>
</div>

<script>
    // "관심작품 등록" 버튼을 클릭했을 때 별 색상과 텍스트 변경
    document.getElementById('favorite-btn').addEventListener('click', function(e) {
        e.preventDefault();  // 폼 제출을 막음 (페이지 리로드 방지)
        const favoriteSpan = this.querySelector('span');
        const favoriteText = favoriteSpan.querySelector('span');

        // 상태에 따라 색상 및 텍스트 변경
        if (favoriteSpan.classList.contains('favorite-registered')) {
            favoriteSpan.classList.remove('favorite-registered');
            favoriteSpan.classList.add('favorite-not-registered');
            favoriteText.textContent = '관심작품 등록';
        } else {
            favoriteSpan.classList.remove('favorite-not-registered');
            favoriteSpan.classList.add('favorite-registered');
            favoriteText.textContent = '관심작품 해제';
        }

        // 폼을 실제로 제출하려면 아래 코드 주석을 해제
        this.closest('form').submit();
    });
</script>
